<include file="../public/header_dialog" />
{$usejs}

<div class="so_main">

  <div class="page_tit">{$page_title}</div>
  <div class="tit_tab">
	<ul>
		<li><a class=on href="{:U('admin/sys_message/sys_message_edit',array('message_id'=>$data['message_id']))}">{$page_title}</a></li>
	</ul>
  </div>

<table border="0" cellspacing="0" cellpadding="0" style="width:900px;">
<tr>
<td>
<!--/dialog_start-->

<form method="post" id="act_form" name="act_form" action="{:U('admin/sys_message/sys_message_edit_action')}" enctype="multipart/form-data">
	<table class="add_table" border="0" cellspacing="0" cellpadding="0" >
		<tbody>
				<!-- <tr>
					<th>消息ID：</th>
					<td>{$data.message_id}</td>
				</tr> -->
				<tr>
					<th>选择平台：</th>
					<td>
						<select name="field_uid" id="field_uid"  style="width:100px;" onchange="load_type_info(this.value);">
							<option value="">请选择</option>
							<option value="0" selected >大正</option>
							<option value="1186">美兰湖</option>
						</select>
						<script>set_select_value(document.act_form.field_uid,"{$data.field_uid}");</script>
					</td>
				</tr>
				<!-- <tr>
					<th>推送平台：</th>
					<td>
						<select name="message_type"  style="width:100px;">
							<option value="">请选择</option>
							<option value="android">android</option>
							<option value="ios">ios</option>
						</select>
						<script>set_select_value(document.act_form.message_type,"{$data.message_type}");</script>
					</td>
				</tr> -->
				<tr>
					<th>发送范围：</th>
					<td>
						<select name="receiver_type" id="receiver_type" style="width:100px;" onchange="load_type_info(this.value);">
							<option value="">请选择</option>
							<option value="4">所有用户</option>
							<option value="3">指定用户</option>
						</select>
						<script>set_select_value(document.act_form.receiver_type,"{$data.receiver_type}");</script>
					</td>
				</tr>
				<tr>
					<th>消息标题：</th>
					<td><input type="text" name="message_title" id="message_title" class="mod_input2" style="width:300px;"  value="{$data.message_title}"></td>
				</tr>
				<tr>
					<th>消息内容：</th>
					<td><textarea name="n_content" id="n_content" class="mod_input2" style="width:400px; height:100px;">{$data['message_content']['n_content']}</textarea></td>
				</tr>
				<tr>
					<th>消息图片：</th>
					<td><php>if($data['message_pic']){</php><img src="{$data.message_pic}"style="max-height:100px; max-width:100px;"><php>}</php><br/><input type="file" name="message_pic" id="message_pic" class="mod_input2" style="width:300px;"></td>
				</tr>
				
				<tr class="type_3">
					<th>目标用户：</th>
					<td><input type="text" name="uid" id="uid" class="mod_input2" style="width:100px;"  value="{$data.uid}"></td>
				</tr>
				<tr>
					<th>扩展信息：</th>
					<td>
						<select name="ext_action" style="width:100px;">
							<option value="">请选择</option>
							<option value="event_list">赛事列表</option>
							<option value="wap">WAP</option>
							<option value="bmw_apply">门票报名</option>
							<option value="mathcenter">赛事直播</option>
							<option value="blog_detail">博客详细页</option>
							<option value="app_store">APP STORE</option>
						</select>
						<script>set_select_value(document.act_form.ext_action,"{$data['message_content']['n_extras']['action']}");</script>
					</td>
				</tr>
				<tr>
					<th></th>
					<td>
						<input type="text" name="ext_id" id="ext_id" class="mod_input2" style="width:100px;"  value="{$data['message_content']['n_extras']['id']}">（相应ID：赛事直播sid   /  博客blogid）
					</td>
				</tr>
				<tr>
					<th></th>
					<td>

						<input type="text" name="ext_title" id="ext_title" class="mod_input2" style="width:100px;"  value="{$data['message_content']['n_extras']['title']}">（相应TITLE，当扩展信息为WAP是此处填写wap地址）
					
					</td>
				</tr>
				
		</tbody>
		<tfoot>
			<tr>
				<th>&nbsp;</th>
				<td>
					<input type="hidden" name="message_id" value="{$data.message_id}">
					<input type="submit" class="btn_b" value="保存" style="margin-right:10px;"/>
					<input type="button" class="btn_w" onclick="close_dialog(this)" value="取消" />
				</td>
		</tfoot>
	</table><!--/add_table-->
</form>



<script>
$(document).ready(function(){
load_type_info($("#receiver_type").val());
$.formValidator.initConfig({formID:"act_form",theme:'ArrowSolidBox',mode:'AutoTip',onError:function(msg){msg_error(msg)},inIframe:true});
		$("#field_uid").formValidator({empty:false,onShow:"请选择推送平台",onFocus:"请选择推送平台",onCorrect:"选择正确"}).inputValidator({min:1,max:50,onError:"请选择推送平台"});
		//$("#message_number").formValidator({empty:false,onShow:"请输入消息编号",onFocus:"请输入消息编号",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入消息编号"});
		//$("#message_type").formValidator({empty:false,onShow:"请输入推送平台",onFocus:"请输入推送平台",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入推送平台"});
		$("#uid").formValidator({empty:true,onShow:"请输入目标用户",onFocus:"请输入目标用户",onCorrect:"输入正确"}).inputValidator({min:1,max:11,onError:"请输入目标用户"});
		$("#message_title").formValidator({empty:false,onShow:"请输入消息标题",onFocus:"请输入消息标题",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入消息标题"});
		$("#n_content").formValidator({empty:false,onShow:"请输入消息内容",onFocus:"请输入消息内容",onCorrect:"输入正确"}).inputValidator({min:1,max:500,onError:"请输入消息内容"});
		//$("#devices_token").formValidator({empty:false,onShow:"请输入设备编号",onFocus:"请输入设备编号",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入设备编号"});
		//$("#message_state").formValidator({empty:false,onShow:"请输入消息状态",onFocus:"请输入消息状态",onCorrect:"输入正确"}).inputValidator({min:1,max:11,onError:"请输入消息状态"});
		$("#receiver_type").formValidator({empty:false,onShow:"请选择发送范围",onFocus:"请选择发送范围",onCorrect:"选择正确"}).inputValidator({min:1,max:11,onError:"请选择发送范围"});
		//$("#message_totalnum").formValidator({empty:false,onShow:"请输入共需发送",onFocus:"请输入共需发送",onCorrect:"输入正确"}).inputValidator({min:1,max:11,onError:"请输入共需发送"});
		//$("#message_sendnum").formValidator({empty:false,onShow:"请输入总发送数",onFocus:"请输入总发送数",onCorrect:"输入正确"}).inputValidator({min:1,max:11,onError:"请输入总发送数"});
		//$("#message_errorcode").formValidator({empty:false,onShow:"请输入错误代码",onFocus:"请输入错误代码",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入错误代码"});
		//$("#message_errormsg").formValidator({empty:false,onShow:"请输入错误信息",onFocus:"请输入错误信息",onCorrect:"输入正确"}).inputValidator({min:1,max:50,onError:"请输入错误信息"});
		//$("#message_sendtime").formValidator({empty:false,onShow:"请输入发送时间",onFocus:"请输入发送时间",onCorrect:"输入正确"}).inputValidator({min:1,max:10,onError:"请输入发送时间"});
		

	$.formValidator.reloadAutoTip();
});

function reloadAutoTip()
{
	$.formValidator.reloadAutoTip();
}

function load_type_info(obj)
{
	//alert(obj);
	if(obj==3)
	{
		$(".type_3").show();
	}
	else
	{
		$("#uid").val('0');
		$(".type_3").hide();
	}
	
}

</script>


<!--/dialog_end-->
</td>
</tr>
</table>

</div>

<include file="../public/_footer" />
